<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-6 col-lg-5">
      <div class="card border-primary shadow rounded-4">
        <div class="card-header bg-primary text-white">
          @if (isLoginMode && !verifyMode) {
            <h2 class="text-center">Sign In</h2>
          } @else if (!isLoginMode && !verifyMode) {
            <h2 class="text-center">Create Account</h2>
          } @else {
            <h2 class="text-center">Verify Email</h2>
          }
        </div>

        <div class="card-body">
          <!-- Login Form -->
          @if (isLoginMode && !verifyMode) {
            <form [formGroup]="loginForm" (ngSubmit)="submitForm()" autocomplete="off">
              <app-text-input
                [formControl]="$any(loginForm.controls['usernameOrEmail'])"
                [label]="'Username or Email'">
              </app-text-input>

              <app-text-input
                [formControl]="$any(loginForm.controls['password'])"
                [label]="'Password'"
                [type]="'password'">
              </app-text-input>

              <div class="d-flex justify-content-end">
                <a href="#" class="text-decoration-none text-info small">Forgot Password?</a>
              </div>

              <div class="form-group text-center mt-4">
                <button [disabled]="!loginForm.valid" class="btn btn-primary me-2" type="submit">Sign In</button>
                <button class="btn btn-default me-2" (click)="cancel()" type="button">Cancel</button>
              </div>
            </form>
          }

          <!-- Register Form -->
          @if (!isLoginMode && !verifyMode) {
            <form [formGroup]="registerForm" (ngSubmit)="submitForm()" autocomplete="off">
              <app-text-input
                [formControl]="$any(registerForm.controls['username'])"
                [label]="'Username'">
              </app-text-input>

              <app-text-input
                [formControl]="$any(registerForm.controls['email'])"
                [label]="'Email'">
              </app-text-input>

              <app-text-input
                [formControl]="$any(registerForm.controls['password'])"
                [label]="'Password'"
                [type]="'password'">
              </app-text-input>

              <app-text-input
                [formControl]="$any(registerForm.controls['confirmPassword'])"
                [label]="'Confirm Password'"
                [type]="'password'">
              </app-text-input>

              <div class="form-group text-center mt-4">
                <button [disabled]="!registerForm.valid" class="btn btn-primary me-2" type="submit">Register</button>
                <button class="btn btn-default me-2" (click)="cancel()" type="button">Cancel</button>
              </div>
            </form>
          }

          <!-- Verification Form -->
          @if (verifyMode) {
            <form [formGroup]="verifyForm" (ngSubmit)="submitForm()" autocomplete="off">
              <div class="text-center mb-4">
                <i class="fas fa-envelope-open-text fa-3x text-primary"></i>
                <p class="mt-3">We've sent a verification code to your email address. Please enter it below to complete your registration.</p>
              </div>

              <app-text-input
                [formControl]="$any(verifyForm.controls['code'])"
                [label]="'Verification Code'">
              </app-text-input>

              <div class="form-group text-center mt-4">
                <button [disabled]="!verifyForm.valid" class="btn btn-primary me-2" type="submit">Verify Email</button>
                <button class="btn btn-default me-2" (click)="cancel()" type="button">Cancel</button>
              </div>
            </form>
          }

          <!-- Validation errors display -->
          @if(validationErrors) {
            <div class="alert alert-danger mt-3">
              <ul>
                @for(error of validationErrors; track $index) {
                  <li>{{error}}</li>
                }
              </ul>
            </div>
          }

          <!-- Toggle between Login and Register -->
          @if(!verifyMode) {
            <div class="text-center mt-4">
              <p class="mb-0">
                @if(isLoginMode) {
                  <span>Don't have an account? <a href="javascript:void(0)" class="text-info" (click)="toggleMode()">Sign Up</a></span>
                } @else {
                  <span>Already have an account? <a href="javascript:void(0)" class="text-info" (click)="toggleMode()">Sign In</a></span>
                }
              </p>
            </div>
          }
        </div>
      </div>
    </div>
  </div>
</div>
